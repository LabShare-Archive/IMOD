.na
.nh
.TH tomostitch 1 3.10.5 BL3DEMC
.SH NAME
tomostitch \- Warps, stacks, and blends a montage of overlapping volumes
.SH SYNOPSIS
tomostitch options supermontage_info_file
.SH DESCRIPTION
Tomostitch is a Python program for performing the final steps in stitching
together adjacent, overlapping volumes.  These steps are: 1) running
Findwarp(1) on the warping patch vectors produced by Stitchalign(1); 
2) running Warpvol(1) to produce the aligned volumes; 3) running Densmatch(1)
to match their densities and Newstack(1) to stack them into a single file; and
4) running Blendmont(1) to produce the final stitched volume.  By default, the
program will run all of these steps, but there are options to run just a
subset of consecutive steps.
.P
There are options for running with a subset of the volumes.  These options can
be used either for experimenting or for building a subset of the stitched
reconstruction.  They apply to all of the steps except blending, since
whichever volumes have been stacked are the ones that will be blended.  It may
be useful to run the first step alone, interactively, since it might fail on
some volumes and require editing of patch vectors or adjustment of parameters.
If necessary, the step can then be rerun just on the volumes that failed.
The other steps might be better run from a command file so that output can be
collected in a log.
.P
The size of the warped volumes in X and Y was set when Stitchalign(1) was run
and cannot be adjusted in this program.  The thickness can be specified.
.P
Artifacts in the blended volume can be minimized by setting a limit for the
slices from which edge functions will be computed.  Edge functions computed
from areas outside the section are prone to errors which differ radically from
slice to slice, making the remaining image features jump around when paging
through the slices.  The solution
is to use the edge functions computed on the last good slice for slices
outside the range of good slices.  A lower and upper limit on the slices with
good edge functions can be set with the -goodedge option.  Using a single
limit for all edges may not be appropriate, so limits can also be set for
individual edges.  If -goodedge is entered, its limits
apply to all edges that do not have individual limits.  Limits can be
specified for individual edges in two ways.  One is with the -onegood option,
where one must specify the number in X and Y of the frame below or to the left
of the edge, and whether the edge is between two pieces adjacent in X or
adjacent in Y.  The other way is to make an entry in the info file in the
section for the particular edge, of the form:
.br
    goodLimits = # #
.br
where the two numbers are the lower and upper Z limits.  Note that in either
of these cases, the slices are numbered from 1 and can be read directly out of
3dmod.  Once you have defined these limits, you can rerun the blend operation,
specifying -oldedge to avoid recomputing edge functions.
.P
Another kind of artifact can occur in the overlap zones when the transformed
volumes contain significant areas filled with a uniform velue due to large
shifts.  To handle this problem, an option is supplied to Blendmont(1) to
exclude these areas from edge functions and from being used when blending
across edges.
.P
This program outputs a command file for the blending operation that could be
used to run Blendmont(1) with different parameters not accessible through this
interface.  The file is named blend_section_name.com.

.SS Options
Tomostitch uses the PIP package for input (see the manual page
for pip(1)).  Options can be specified either as command line
arguments (with the -) or one per line in a command file
(without the -):
INSERT OPTION TEXT HERE
.TP
.B -StandardInput
Read parameter entries from standard input

.SH FILES
When Findwarp(1) is run, several files are produced for each piece:
  piecename.warpxf     has the warping transforms
  piecename_res.patch  is a file with the patch vectors and residuals
  piecename_res.mod    is a model made from these patches
.br
When Warpvol(1) is run, it produces files named "piecename.warped".
.br
When the warped volumes are stacked, the output files are
  section_name.st      the stacked volumes
  section_name.pl      the piece list
.br
The output file from blending is "section_name.bl"

.SH AUTHOR
.nf
David Mastronarde
.fi
.SH SEE ALSO
findwarp(1), warpvol(1), newstack(1), densmatch(1), blendmont(1), 
stitchalign(1)
.SH BUGS
In Windows, if you wish to run the program from a command file and do not have
Cygwin Python installed, you need either to invoke the program with
.br
   runpyscript tomostitch
.br
or run the command file with a Python interpreter by either giving the
extension ".pcm" or using the "-p" option to subm.
.P
Email bug reports to mast@colorado.edu.
