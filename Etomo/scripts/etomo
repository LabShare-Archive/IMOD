#!/bin/sh
#
# Description: startup script for eTomo
# 
# Copyright: Copyright (c) 2002, 2003
# Boulder Laboratory for 3D Fine Structure, University of Colorado
# 
# $Author$
# 
# $Revision$
# 
# $Log$
# Revision 1.6  2003/06/13 19:24:29  rickg
# Added LD_ASSUME_KERNEL=2.4.1 export
#
# Revision 1.5  2003/04/25 22:04:07  rickg
# Added echoing at startup
#

#  Workaround for java 1.4.0 / new threading library clash
export LD_ASSUME_KERNEL=2.4.1

# Test for existance of IMOD_DIR
if [ -z "$IMOD_DIR" ]; then
  echo "The IMOD_DIR environment variable has not been set"
  echo "Set it to point to the directory where IMOD is installed"
  exit
fi
if [ ! -e $IMOD_DIR ]; then
  echo "IMOD_DIR="${IMOD_DIR} " does not exist"
  echo "Set it to point to the directory where IMOD is installed"
  exit
fi

# Test for appropriate java run time
if ! type -t java 2>&1 > /dev/null ; then
  echo "There is no java runtime in the current search path.  A Java runtime"
  echo "environment needs to be installed and the command search path needs"
  echo "be defined to locate the java command."
fi


# If we have a qtlib directory in IMOD_DIR then use that, otherwise try to use
# the system QTDIR.  Also force our libraries to the front of the shared object
# library search path as well as the system libraries since we have seen other apps
# clashing with libGL
if [ -e ${IMOD_DIR}/qtlib ]; then
  export LD_LIBRARY_PATH=${IMOD_DIR}/qtlib:${IMOD_DIR}/lib:/usr/lib:${LD_LIBRARY_PATH}
elif [ ! -z "$QTDIR" ]; then
  export LD_LIBRARY_PATH=${QTDIR}/lib:${IMOD_DIR}/lib:/usr/lib:${LD_LIBRARY_PATH}
else
  echo "WARNING: An explicit QT library is not defined."
  echo "Some graphical programs may not work."
fi

# Copy the previous log files to backups
if [ -e etomo_out.log ]; then
  cp etomo_out.log etomo_out.log~
fi
if [ -e etomo_err.log ]; then
  cp etomo_err.log etomo_err.log~
fi
echo "starting eTomo"
java -cp ${IMOD_DIR}/bin/etomo -jar ${IMOD_DIR}/bin/etomo.jar $@ \
  2>etomo_err.log >etomo_out.log &
