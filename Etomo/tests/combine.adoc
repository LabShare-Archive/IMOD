Version = 1.2

[function = copy]
[[if = simple-align]]
  copy.file = tomopitch%{axis}_simple-align.mod|tomopitch%{axis}.mod
[[]]
[[ifnot = simple-align]]
  run.function.non-simple-align-copy=
[[]]


[function = non-simple-align-copy]
[[if = patch-tracking]]
  copy.file = tomopitch%{axis}_patch-tracking.mod|tomopitch%{axis}.mod
[[]]
[[ifnot = patch-tracking]]
  copy.file = tomopitch%{axis}.mod
[[]]

[function = main]
[[if = patch-tracking]]
	#use matching models for patch tracking
	rb.use-matching-models-only=
	cb.load-binned-by-2=
	copy.file=%{dataset}a_patch-tracking.matmod|%{dataset}a.matmod
	copy.file=%{dataset}b_patch-tracking.matmod|%{dataset}b.matmod
	bn.create-matching-models-in-3dmod=
	cb.use-patch-region-model=
	copy.file=patch_region_patch-tracking.mod|patch_region.mod
	bn.create/edit-patch-region-model=
  tf.z-axis-min = %{z-axis-min-patch-tracking}
  tf.z-axis-max = %{z-axis-max-patch-tracking}
[[]]
[[ifnot = patch-tracking]]
  tf.z-axis-min = %{z-axis-min}
  tf.z-axis-max = %{z-axis-max}
[[]]
cb.parallel-processing = 1
mb.parallel-processing = -
bn.create-combine-scripts =
wait.process.creating-combine-scripts = done
assert.exists.file = combine.com
assert.exists.file = matchorwarp.com
assert.exists.file = matchvol1.com
assert.exists.file = matchvol2.com
assert.exists.file = patchcorr.com
assert.exists.file = solvematch.com
assert.exists.file = volcombine.com
assert.exists.file = warpvol.com
bn.start-combine =
wait.process.processchunks-volcombine = done
assert.exists.file = volcombine-finish.com
assert.exists.file = volcombine-start.com
assert.exists.file = volcombine-finish.log
assert.exists.file = volcombine-start.log
assert.exists.file = combine.log
assert.exists.file = matchorwarp.log
assert.exists.file = matchvol1.log
assert.exists.file = patchcorr.log
assert.exists.file = solvematch.log
cb.parallel-processing = 0
bn.restart-at-volcombine =
wait.process.combine = done
assert.exists.file = volcombine.log
bn.restart-at-volcombine =
wait.process.combine = done
sleep =
assert.exists.file = volcombine.log~
cb.parallel-processing = 1
tb.setup = 
bn.start-combine =
wait.process.processchunks-volcombine = done
assert.exists.file = combine.log~
assert.exists.file = matchorwarp.log~
assert.exists.file = matchvol1.log~
assert.exists.file = patchcorr.log~
assert.exists.file = solvematch.log~
sleep = 
[[if = test-gui]]
  run.function.test-final-match=
[[]]
bn.replace-patch-vectors =
bn.done =


[function = test-final-match]
#test field validation
tb.setup.2=
mb.patchcorr-parameters.1=A
cb.kernel-filtering-with-sigma=on
tf.kernel-filtering-with-sigma=1.0abc
bn.restart-at-patchcorr=
wait.popup.field-validation-failed=OK
assert.disabled.bn.kill-process=
tf.kernel-filtering-with-sigma=1.0
cb.kernel-filtering-with-sigma=off
