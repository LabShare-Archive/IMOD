Version = 1.2

[function = run]
#full align
bn.create-full-aligned-stack =
waitfor.process.newst = done
bn.done =

[function = test]
#full align
bn.create-full-aligned-stack =
waitfor.process.newst = done
assert.file.exists = newst%{axis}.log
bn.create-full-aligned-stack =
waitfor.process.newst = done
assert.file.exists = newst%{axis}.log~
function = ctf-correction
function=erase-gold
function = filtering
function = done

[function = montage]
#full align
bn.create-full-aligned-stack =
waitfor.process.blend = done
assert.file.exists = blend%{axis}.log
bn.create-full-aligned-stack =
waitfor.process.blend = done
assert.file.exists = blend%{axis}.log~
function = ctf-correction
function=erase-gold
function = filtering
function = done

[function = ctf-correction]
#check screen
tp.create.1 =
function = ctf-correction-base-values
function = ctf-correction-base-enabled
cb.use-expected-defocus-instead-of-ctfplotter-output =
function = expected-defocus-enabled
#run
#test ctf plotter
cb.use-expected-defocus-instead-of-ctfplotter-output =
tf.config-file = /usr/local/ImodCalib/CTFnoise/F20.cfg
bn.run-ctf-plotter =
sleep =
assert.file.exists = ctfplotter%{axis}.log
#test ctf correction
cb.use-expected-defocus-instead-of-ctfplotter-output =
bn.correct-ctf =
waitfor.process.ctf-correction = done
assert.file.exists = %{dataset}%{axis}_simple.defocus
assert.file.exists = ctfcorrection%{axis}.log
assert.file.exists = %{dataset}%{axis}_ctfcorr.ali
cb.parallel-processing =
tf.expected-defocus = 8500.0
bn.correct-ctf =
waitfor.process.ctf-correction = done
assert.file.exists = %{dataset}%{axis}_simple.defocus~
assert.file.exists = ctfcorrection%{axis}.log~
assert.file.exists = %{dataset}%{axis}_ctfcorr.ali~
bn.view-ctf-correction =
bn.use-ctf-correction =
cb.parallel-processing =

[function = erase-gold]
#check screen
tp.create.2=
function = erase-gold-base-values
function = erase-gold-base-enabled
#run
#test xfmodel
bn.transform-fiducial-model=
waitfor.process.xfmodel=done
assert.file.exists=%{dataset}%{axis}_erase.fid
bn.transform-fiducial-model=
waitfor.process.xfmodel=done
assert.file.exists=%{dataset}%{axis}_erase.fid~
bn.view-transformed-model=
#test ccderaser
bn.erase-beads=
waitfor.process.ccderaser=done
assert.file.exists=%{dataset}%{axis}_erase.ali
bn.erase-beads=
waitfor.process.ccderaser=done
assert.file.exists=%{dataset}%{axis}_erase.ali~
bn.view-erased-stack=
bn.use-erased-stack=
waitfor.popup.etomo-question = Yes

[function = filtering]
tp.create.3 = 
bn.filter =
waitfor.process.mtffilter = done
assert.file.exists = mtffilter%{axis}.log
bn.filter =
waitfor.process.mtffilter = done
assert.file.exists = mtffilter%{axis}.log~
bn.view-filtered-stack =
bn.use-filtered-stack =
mb.parallel-processing-open = 1
mb.parallel-processing-more = 1

[function = done]
bn.done =
waitfor.popup.etomo-question = Yes
waitfor.popup.etomo-question = Yes

[function = ctf-correction-base-values]
assert.tf.voltage = 200
assert.tf.spherical-aberration = 2
assert.tf.config-file =
assert.tf.expected-defocus = 8000.0
assert.cb.use-expected-defocus-instead-of-ctfplotter-output = 0
assert.cb.parallel-processing = 1
assert.tf.interpolation-width = 20
#advanced
mb.ctf-correction-advanced = 1
assert.tf.amplitude-contrast = 0.07
assert.tf.defocus-tolerance = 200
mb.ctf-correction-advanced = 0

[function = ctf-correction-base-enabled]
assert.tf.voltage.enabled = 1
assert.tf.spherical-aberration.enabled = 1
assert.tf.config-file.enabled = 1
assert.tf.expected-defocus.enabled = 1
assert.bn.run-ctf-plotter.enabled = 1
assert.cb.use-expected-defocus-instead-of-ctfplotter-output.enabled = 1
assert.cb.parallel-processing.enabled = 1
assert.tf.interpolation-width.enabled = 1
#advanced
mb.ctf-correction-advanced = 1
assert.tf.amplitude-contrast.enabled = 1
assert.tf.defocus-tolerance.enabled = 1
mb.ctf-correction-advanced = 0

[function = expected-defocus-enabled]
assert.tf.voltage.enabled = 1
assert.tf.spherical-aberration.enabled = 1
assert.tf.config-file.enabled = 0
assert.tf.expected-defocus.enabled = 1
assert.bn.run-ctf-plotter.enabled = 0
assert.cb.use-expected-defocus-instead-of-ctfplotter-output.enabled = 1
assert.cb.parallel-processing.enabled = 1
assert.tf.interpolation-width.enabled = 1
#advanced
mb.ctf-correction-advanced = 1
assert.amplitude-contrast.enabled = 1
assert.tf.defocus-tolerance.enabled = 1
mb.ctf-correction-advanced = 0

[function = erase-gold-base-values]
assert.bn.transform-fiducial-model = 0
assert.tf.fiducial-diameter=%{fiducial-diameter-pixels}
assert.rb.use-mean-of-surrounding-points = 1
assert.rb.fit-a-plane-to-surrounding-points = 0
assert.bn.erase-beads = 0
assert.bn.use-erased-stack =0

[function = erase-gold-base-enabled]
assert.bn.transform-fiducial-model.enabled = 1
assert.bn.view-transformed-model.enabled = 1
assert.tf.fiducial-diameter.enabled=1
assert.rb.use-mean-of-surrounding-points.enabled =1
assert.rb.fit-a-plane-to-surrounding-points.enabled =1
assert.bn.erase-beads.enabled = 1
assert.bn.view-erased-stack.enabled=1
assert.bn.use-erased-stack.enabled = 1