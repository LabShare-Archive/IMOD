Version = 1.2

[function = run]
//full align
mb.newstack-open = 1
bn.create-full-aligned-stack =
waitfor.process.newst = done
assert.file.exists = newst%{axis}.log
bn.create-full-aligned-stack =
waitfor.process.newst = done
assert.file.exists = newst%{axis}.log~
mb.newstack-open = 0

//ctf correction
//check screen
mb.ctf-correction-open = 1
function = ctf-correction-base-values
function = ctf-correction-base-enabled
cb.use-expected-defocus-instead-of-ctflotter-output =
function = expected-defocus-enabled
//run
//test ctf plotter
cb.use-expected-defocus-instead-of-ctflotter-output =
tf.config-file = /usr/local/ImodCalib/CTFnoise/F20.cfg
bn.ctf-plotter =
sleep =
assert.file.exists = ctfplotter%{axis}.log
//test ctf correction
cb.use-expected-defocus-instead-of-ctflotter-output =
bn.ctf-correction =
waitfor.process.ctf-correction = done
assert.file.exists = %{dataset}%{axis}_simple.defocus
assert.file.exists = ctfcorrection%{axis}.log
assert.file.exists = %{dataset}_ctfcorr.ali
cb-parallel-processing =
tf.expected-defocus = 8500.0
bn.ctf-correction =
waitfor.process.ctf-correction = done
assert.file.exists = %{dataset}%{axis}_simple.defocus~
assert.file.exists = ctfcorrection%{axis}.log~
assert.file.exists = %{dataset}_ctfcorr.ali~
bn-view-ctf-correction =
sleep =
bn-use-ctf-correction =
sleep =
bn.create-full-aligned-stack =
waitfor.process.newst = done

//filtering
mb.2d-filtering-open = 1
bn.filter =
waitfor.process.mtffilter = done
assert.file.exists = mtffilter%{axis}.log
bn.filter =
waitfor.process.mtffilter = done
assert.file.exists = mtffilter%{axis}.log~
bn.use-filtered-stack =
mb.2d-filtering-open = 0
mb.parallel-processing-open = 1
mb.parallel-processing-more = 1

[function = montage]
//full align
mb.blendmont-open = 1
bn.create-full-aligned-stack =
waitfor.process.blend = done
assert.file.exists = blend%{axis}.log
bn.create-full-aligned-stack =
waitfor.process.blend = done
assert.file.exists = blend%{axis}.log~
mb.blendmont-open = 0

//ctf correction
mb.ctf-correction-open = 1
function = ctf-correction-base-values
function = ctf-correction-base-enabled
cb.use-expected-defocus-instead-of-ctflotter-output =
function = expected-defocus-enabled
cb.use-expected-defocus-instead-of-ctflotter-output =
tf.config-file = /usr/local/ImodCalib/CTFnoise/F20.cfg
cb.use-expected-defocus-instead-of-ctflotter-output =
bn.ctf-correction =
waitfor = ctf-correction
bn-view-ctf-correction =
sleep =
bn-use-ctf-correction =

//filtering
mb.2d-filtering-open = 1
bn.filter =
waitfor.process.mtffilter = done
assert.file.exists = mtffilter%{axis}.log
bn.filter =
waitfor.process.mtffilter = done
assert.file.exists = mtffilter%{axis}.log~
bn.use-filtered-stack =
mb.2d-filtering-open = 0
mb.parallel-processing-open = 1
mb.parallel-processing-more = 1

[function = ctf-correction-base-values]
assert.tf.voltage = 200
assert.tf.sperical-aberration = 2
assert.tf.config-file =
assert.tf.expected-defocus = 8000.0
assert.cb.use-expected-defocus-instead-of-ctflotter-output = 0
assert.cb.parallel-processing = 1
assert.tf.interpolation-width = 20
//advanced
mb.ctf-correction-advanced = 1
assert.amplitude-contrast.enabled = 1
assert.amplitude-contrast = 0.07
assert.tf.defocus-tolerance = 200
mb.ctf-correction-advanced = 0

[function = ctf-correction-base-enabled]
assert.tf.voltage.enabled = 1
assert.tf.sperical-aberration.enabled = 1
assert.tf.config-file.enabled = 1
assert.tf.expected-defocus.enabled = 1
assert.bn.ctf-plotter.enabled = 1
assert.cb.use-expected-defocus-instead-of-ctflotter-output.enabled = 1
assert.cb.parallel-processing.enabled = 1
assert.tf.interpolation-width.enabled = 1
//advanced
mb.ctf-correction-advanced = 1
assert.amplitude-contrast.enabled = 1
assert.tf.defocus-tolerance.enabled = 1
mb.ctf-correction-advanced = 0

[function = expected-defocus-enabled]
assert.tf.voltage.enabled = 1
assert.tf.sperical-aberration.enabled = 1
assert.tf.config-file.enabled = 0
assert.tf.expected-defocus.enabled = 1
assert.bn.ctf-plotter.enabled = 0
assert.cb.use-expected-defocus-instead-of-ctflotter-output.enabled = 1
assert.cb.parallel-processing.enabled = 1
assert.tf.interpolation-width.enabled = 1
//advanced
mb.ctf-correction-advanced = 1
assert.amplitude-contrast.enabled = 1
assert.tf.defocus-tolerance.enabled = 1
mb.ctf-correction-advanced = 0