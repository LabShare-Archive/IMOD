     BBoouullddeerr LLaabboorraattoorryy ffoorr 33--DDiimmeennssiioonnaall EElleeccttrroonn MMiiccrroossccooppyy ooff CCeellllss

CORRSEARCH3D(1)						        CORRSEARCH3D(1)

NNAAMMEE
	corrsearch3d - search for array of 3D displacements between two volumes

SSYYNNOOPPSSIISS
	corrsearch3d

DDEESSCCRRIIPPTTIIOONN
  Corrsearch3d will determine the 3D displacement between two image
  volumes at a regular array of positions.  At each position, it
  extracts a patch of a specified size from each volume, then
  searches for a local maximum in the cross-correlation between the
  two patches.  The starting point of the search is based upon the
  displacements of adjacent patches that have already been determined.
  If there are no such adjacent patches, or if no maximum is found for
  displacements within a specified range, the program runs the script
  onepatchcorr to obtain a displacement by FFT-based cross-
  correlation.  The program works from the center of the volume
  outward, analyzing patches in the X, then the Y, then the Z
  direction.  An optional model file can be entered with contours
  enclosing the area where patches should be analyzed; patches outside
  this area are excluded.  Also, information about the source volume
  for the file being transformed can be entered so that the program
  can analyze patches only from regions that are good in the second
  image file.
  
  Inputs to the program:
  
  Name of reference image file being aligned to
  
  Name of image file that will be transformed to match
  
  Name of output file for patch positions and displacements
  
  Name of a temporary file for output from onepatchcorr
  
  Name of a model file with contours that enclose the areas where
  patches should be analyzed, or Return to analyze patches at all
  locations
  
  Size of patches in X, Y and Z
  
  Number of patches in the X, Y and Z directions
  
  Size of borders to be excluded on the lower and upper sides in X,
  the lower and upper sides in Y, and the lower and upper sides in Z
  
  Number of pixels over which to taper the patches in X, Y and Z
  
  Maximum displacement to determine by searching
  
  Either the X, Y, and Z size or the name of the original source
  volume for the second image file.  Return to omit analysis of
  positions in this file.
  
  Name of the 3-D transformation file used to generate the second
  image file from its source volume, or Return to omit analysis of
  positions in the second file.
  
  Size of borders to be excluded on the lower and upper sides in X
  and the lower and upper sides in Z in the original source volume
  for the second image file.
  
  The program outputs an initial line with the total number of
  patches, then one line for each patch, containing the X, Y, and Z
  coordinates of the patch and the displacement between the two files
  in X, Y, and Z.

  The program runs onepatchcorr by telling tcsh to run the script in
  $IMOD_DIR/bin; therefore IMOD_DIR must be defined.  If tcsh is not
  available or you wish to run with a different shell, define the
  environment variable IMOD_CSHELL with the name of the alternate C
  shell, including any desired flags (the -f flag is added 
  automatically)

HHIISSTTOORRYY
  Written by David Mastronarde  7/16/01
  7/20/02: Added analysis of areas to exclude based on positions in the
	source for the second volume
