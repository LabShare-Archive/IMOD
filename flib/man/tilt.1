     BBoouullddeerr LLaabboorraattoorryy ffoorr 33--DDiimmeennssiioonnaall EElleeccttrroonn MMiiccrroossccooppyy ooff CCeellllss

TILT(1)									TILT(1)

NNAAMMEE
	tilt - calculates 3-D tomographic reconstruction from a tilt series

SSYYNNOOPPSSIISS
	tilt [input filename] [output filename]

DDEESSCCRRIIPPTTIIOONN

  Tilt is a program for reconstructing a three-dimensional object
  from a series of two-dimensional projections.
  The projections are assumed to arise from rotation about
  a fixed tilt axis.

  The program will accept file names either from the command line or as
  entries to the program after it is started.  If there are two names
  on the command line, they will be taken as the input and output file
  names; if there is one name, it will be taken as the input file name
  and the program will ask for the output file name; if there are no
  command line arguments, the program will ask for both input and
  output file names.

  The program uses a number of different numerical strategies
  depending on whether the reconstructed volume is rotated around the
  X axis and depending on the amount of memory available.  If there is
  no X-axis tilt being imposed, then each output plane is derived from
  one line of the input data.  The program tries first to use the fast
  backprojection algorithm developed by Sandberg and Beylkin.  If there
  is insufficient memory for this, or if other preconditions are not
  satisfied, it then tries to use preliminary stretching of each input
  line by the cosine of the tilt angle, which speeds up the direct
  backprojection.  If there is not enough memory for this method
  either, the program falls back to direct backprojection from the
  unstretched input lines. 

  When a tilt around the X axis is specified, then each output slice
  derives from several lines of input data.  The program tries to do
  this first by computing untilted slices, one per input line, and
  interpolating an output slice from the relevant untilted slices.
  It uses fast backprojection if possible; if not, it tries to use
  cosine stretching if possible, or falls back to direct computation.
  If there is insufficient memory for this approach, the program
  reverts to "old-style" X-axis tilting, in which the output slice is
  computed directly from the various input slices.  In this case,it
  also tries to use cosine stretching if memory is available.

  The user can disable various strategies by specifying an
  interpolation order of 0: cosine stretching by entering
  "COSINTERP 0", fast backprojection by entering "FBPINTERP 0", or the
  new style of X-axis tilting by entering "XTILTINTERP 0".  There are
  some cases where the fast backprojection is slower than the
  conventional approach (e.g., few input views).  The program attempts
  to detect these cases and use conventional summation instead.  If
  you use "FBPINTERP 1", you can bypass this checking and force the 
  program to use fast backprojection as long as other conditions are
  met.

-----------------------------------------------------------

  INPUTS TO THE PROGRAM

  Each line of input to the program consists of a keyword, usually
  followed by one or more values.  The following are all possible
  input lines.  Many of these are optional, and they can be input in
  any order.  The keyword can be in upper or lower case.

  ANGLES  TILT_ANGLES
  ------
  Use this line to specify the tilt angles of the views.  Put the tilt
  angles after ANGLES, separated by spaces.  You must enter one tilt
  angle for each view.  Use more than one ANGLES line if necessary.
  This information will override tilt angles specified in the file
  header.  If you enter angles in this way, the file header need not
  contain tilt information.
  
  COMPFRACTION   FRACTION
  ------
  Use this line if the compression measured by TILTALIGN occurred over
  only a FRACTION of the distance between the fiducials.

  COMPRESS   COMPRESSIONS
  ------
  With this line, the program will assume that the section has
  compressed in Z by the amount given by the COMPRESSION for each
  view.  The compressions would be taken directly from the  output of
  TILTALIGN for incremental compression.  A value must be entered for
  each view.

  COSINTERP  ORDER  FACTOR
  ------
  Use this line to control the interpolation ORDER and sampling FACTOR
  for cosine stretching of the input data.  ORDER can be 1 for linear,
  2 for quadratic, 3 for cubic, or 0 to disable cosine stretching.
  The default is linear to provide some smoothing of the data; higher
  orders are appropriate if data are relatively noise-free.  FACTOR is
  optional; the default is 2, which prevents further smoothing when
  the stretched data are linearly interpolated during backprojection.  

  DENSWEIGHT   NADJACENT   WEIGHTS
  ------
  Use this line to weight each view proportionally to the local
  average tilt increment between views.  NADJACENT specifies the
  number of intervals on EACH side of a view to consider; the default
  is 2.  Optionally, one may also enter that number of WEIGHTS to be
  applied in averaging the adjacent increments.

  DONE
  ------
  Put this line at the end to terminate data entry if you wish to put
  commands to run another program in the same command file.

  EXCLUDE  VIEWS	  
  ------
  Use this line to specify a subset of views to be excluded from the
  reconstruction.  Put the view numbers after the EXCLUDE statement,
  separated by spaces.  Use more than one EXCLUDE line if the numbers
  do not all fit on one line.  You may not have both an INCLUDE and an
  EXCLUDE line.

  EXCLUDELIST  VIEWLIST
  EXCLUDELIST2  VIEWLIST
  ------
  This line is an alternative way to specify views to be excluded.  The
  VIEWLIST should be a list of ranges, separated by commas, and with no
  embedded spaces; e.g., 1-3,54,67,85-88.  You may have any number of
  EXCLUDE, EXCLUDELIST, and EXLCUDELIST2 lines, but they cannot be 
  combined with INCLUDE lines.

  FBPINTERP  ORDER
  ------
  Use this line to specify the interpolation ORDER for the fast
  backprojection algorithm: 1 for linear interpolation (the default),
  3 for cubic spline interpolation, which will low-pass filter the
  input data more, or 0 to disable fast backprojection.  Entering a 
  value with this option will also force the program to use fast
  backprojection even if the width, thickness, and number of views
  are small enough so that fast backprojection will run slower than
  direct summation.

  FULLIMAGE XSIZE YSIZE
  ------
  Use this line to specify the full size XSIZE by YSIZE of the
  original stack of tilted views, so that a subset of the aligned
  stack can be handled properly when using a global X-axis tilt or
  local alignments.

  INCLUDE  VIEWS	  
  ------
  Use this line to specify a subset of views to be used for the
  reconstruction.  Put the view numbers after the INCLUDE statement,
  separated by spaces.  Use more than one INCLUDE line if the numbers
  do not all fit on one line.

  LOCALFILE   Filename
  ------
  Use this line to specify a file containing local tilt alignment
  information.

  LOCALSCALE  FACTOR   
  ------
  If local tilt alignments were obtained from unreduced data, but the
  aligned stack was reduced by binning or transforming, use this line
  to specify the FACTOR by which the data were scaled, so that the
  local alignment information can be adjusted.

  LOG BASE
  ------
  This line allows one to generate a reconstruction using the
  logarithm of the densities in the input file, with the value BASE 
  added before taking the logarithm.

  MASK   RMASK
  ------
  This line allows a mask to be applied so as to exclude from the
  reconstructed volume those parts which  lie outside the volume for
  which reconstruction is actually possible.  The volume for which
  reconstruction is possible is a cylinder whose axis lies along the
  tilt axis. Grid points outside this volume will be set to value
  RMASK.  THIS OPTION CAN BE IGNORED FOR THIN SECTIONS, where the
  thickness is considerably smaller than the maximum radius about the
  tilt axis on the zero angle projection.  For 'thick' sections, this
  option saves some execution time.

  MODE    NEWMODE
  ------
  This line allows one to specify the data mode of the output file,
  which is 2 by default.  Be sure to use an appropriate SCALE line so
  that data will be scaled to the proper range.

  OFFSET   DELANG DELXX
  ------
  This line allows an offset of DELANG degrees to be applied to all
  tilt angles and indicates that the tilt axis is offset in the
  projection images, cutting the X-axis at  NX/2. + DELXX instead of
  NX/2.  DELANG positive rotates reconstructed sections anticlockwise.
  The DELXX entry is optional and defaults to 0 when omitted.  If the
  tilt axis is offset from the center because the projection images are a
  non-centered subset of the full images, use the SUBSETSTART entry
  instead.

  PERPENDICULAR or  PARALLEL
  ------
  This line controls which axis order is used for the final
  reconstruction.  PARALLEL mode produces sections parallel to the
  plane of the zero tilt projection, PERPENDICULAR mode produces
  sections normal to the tilt axis.

  RADIAL   IRMAX IFALL  or RMAX RFALL
  ------
  This line controls the radial weighting function.  The radial
  weighting function is linear away from the origin for a distance of
  IRMAX in reciprocal space followed by a gaussian fall-off of s.d.
  IFALL.  The distances may be specified either as pixels (values
  greater than 1) or as frequencies (cycles/pixel) in Fourier space
  (values < 1).

  REPLICATE  NREPLIC REPINC
  ------
  With this line, the input views will be replicated NREPLIC times,
  with an increment of REPIN degrees added to the original angles for
  each replication.  For example, if you can assume 9-fold symmetry,
  enter REPLICATE 8 40.  More than one REPLICATE line can be entered.
  
  REPROJECT
  ------
  With this line, the program will output a single image, a
  reprojection at zero degrees.  To get a reprojection at an arbitrary
  angle, combine this with an OFFSET entry; you will have to increase
  the reconstructed thickness to get a proper reprojection with high
  angles.

  SCALE   FLEVL SCALE
  ------
  This line allows a linear change of density in the  reconstructed
  image according to the formula
  ARRAY(I)=(ARRAY(I)+FLEVL)*SCALE
  After the reconstruction is complete, the program will output the
  scale values that would make the data range from 10 to 245.

  SHIFT   XOFFSET  ZOFFSET
  ------
  This line allows one to shift the reconstructed slice in X or Z
  before it is output.  If XOFFSET is positive, the slice will be
  shifted to the right, and the output will contain the left part of
  the whole potentially reconstructable area.  If ZOFFSET is positive,
  the slice is shifted upward.  The ZOFFSET entry is optional and
  defaults to 0 when omitted.
  
  SLICE   ISLICE JSLICE IDELSLICE
  ------
  This line allows a limited part of the map to be reconstructed and
  is useful for test purposes. A slab from column ISLICE to column
  JSLICE (that is, along the medium axis, perpendicular to the tilt
  axis) of the volume is reconstructed, at intervals of IDELSLICE.
  Slices are numbered from 0.  The IDELSLICE entry is optional and
  defaults to 1 when omitted.

  SUBSETSTART IX IY
  ------
  If the aligned stack contains a subset of the area in the original
  images, and this area is not centered in X or a global X-axis tilt or
  local alignments are being used, use this line to enter the index
  coordinates IX, IY of the lower left corner of the subset within the
  original images.  A FULLIMAGE line must also be entered.

  THICKNESS   ITHICK
  ------
  This line controls the thickness (along the z-axis) of the
  reconstructed volume, the thickness being ITHICK pixels.

  TILTFILE   Filename
  ------
  Use this line to specify a file containing a list of all tilt
  angles.  The angles may be one per line or many per line.

  TITLE   string
  ----- 
  An alphanumeric string giving the title for the job, which will be
  added to the output map.  Limit 50 characters.  This entry is
  optional; the default is "Tomographic reconstruction".

  WIDTH   IWIDE
  ------
  This line specifies the width of the output image; the default is
  the width of the input image.

  XAXISTILT   ANGLE
  ------
  This line allows one to rotate the reconstruction around the X axis,
  so that a section that appears to be tilted around the X axis can be
  made flat to fit into a smaller volume.  The ANGLE should be the
  tilt of the section relative to the X-Y plane in an unrotated
  reconstruction.  For example, if the reconstruction extends 500
  slices, and the section is 5 pixels below the middle in the first
  slice and 5 pixels above the middle in the last slice, ANGLE should
  be 1.1 (the arc sine of 10/500).
  
  XTILTFILE   Filename
  ------
  Use this line to specify a file containing a list of tilts around
  the X axis for the individual views.  A global tilt specified by the
  XAXISTILT line, if any, will be added to these tilts.

  XTILTINTERP  ORDER
  ------
  This line controls the order for interpolating an output slice
  tilted around the X axis from vertical, untilted slices each computed
  from a single line of input data.  Set ORDER to 1 for linear, 2 for
  quadratic, 3 for cubic, or 0 to disable this method of X-axis
  tilting and revert to computing the output slice directly from input
  data.  The default is 1; higher orders are appropriate if data are
  particularly noise-free.

  ZFACTORFILE   Filename
  ------
  Use this line to specify a file containing factors for adjusting the
  backprojection position in each image as a function of Z height in the
  output slice.  These factors are necessary when input images have been
  transformed to correct for an apparent specimen stretch.  If this entry is
  absent, Z factors in a local alignment file will not be applied.

-----------------------------------------------------------------------

  Some notes:

  There are NVIEWS projections taken at tilt angles ANGLES(NV).

  The projections have size NPRJ x MPRJ where NPRJ is taken 
  perpendicular to the tilt axis.

  The reconstructed image has size 
  IWIDE x ITHICK x 1+(JSLICE-ISLICE)/IDELSLICE.
  1+(JSLICE-ISLICE)/IDELSLICE planes are reconstructed, of size 
  IWIDE x ITHICK  lying perpendicular to the tilt axis.

  With perpendicular slices, the header of the output file will set up
  a coordinate system congruent with that of the original views.  If
  slices are output in order of increasing slice number, this
  represents a 90 degree rotation about X, so the slices are inverted
  about their new Z axis (by using the negative of the tilt angles).
  If slices are output in inverted order (IDELSLICE < 0), this
  represents a -90 degree rotation about X; slices are not inverted in
  this case. 

 

HHIISSTTOORRYY

  Originally written by Mike Lawrence.  Storage of tilt angle data 
  altered by Guy Vigers; angles can be stored in image stack header by
  the program ALTERHEADER.
  David Mastronarde added ability to output slices at selected
  intervals and in inverse direction, and setting of header
  information so that coordinates correspond between output file and
  tilt data set.  Also added ability to specify a subset of views to
  use or exclude, control of output mode, abilities to take log,
  replicate views, enter specific tilt angles or read in angles from a
  file, adjust for compression, set width of output, and shift the
  output.  Implemented weighting by local tilt increment and padding
  before filtering.  Added ability to adjust for tilt around the X axis
  and to use local alignments.  Implemented subroutine calls for the
  inner loops so that assembly code could be adjusted to minimize very
  slow steps on the PC.  Implemented cosine stretching of the input
  data as an alternative solution to this problem that is faster on
  all machines.  Incorporated the fast backprojection code developed by
  Kristian Sandberg and Gregory Beylkin.  Implemented X-axis tilting
  by interpolation from untilted slices, so that the fast
  backprojection could be used with X-axis tilting.
