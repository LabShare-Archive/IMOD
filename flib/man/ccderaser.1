     BBoouullddeerr LLaabboorraattoorryy ffoorr 33--DDiimmeennsssiioonnaall EElleeccttrroonn MMiiccrroossccooppyy ooff CCeellllss

CCDERASER(1)							  CCDERASER(1)

NNAAMMEE
	ccderaser - erase X-rays and other defects from images

SSYYNNOOPPSSIISS
	ccderaser [options] [input_file] [output_file]

DDEESSCCRRIIPPTTIIOONN

  This program replaces deviant pixels with interpolated values from
  surrounding pixels.  It is designed to correct defects in electron
  microscope images from CCD cameras.  It can use two algorithms to
  automatically remove peaks in intensity caused by X-rays.  It can also
  take an IMOD model file with specifications of regions to be replaced.
  With a model, the program can replace a group of adjacent pixels with
  interpolated values, or all of the pixels along a line.  It can do
  this on only a specific image, or on all of the sections in the file.
  The program can operate in trial mode, without making an output file,
  and it can output a model file with points at the pixels to be replaced.

  The automatic removal of X-rays works by dividing the area of each image
  into patches for scanning.  The mean and standard deviation (SD) of the
  pixels in a patch are computed.  The patch is then scanned for pixels
  that deviate from the mean by more than a criterion number of SDs (the
  scan criterion, a relatively low number to keep from missing peaks).  When
  such a pixel is found, the program searches neighboring pixels to find a
  peak in intensity.  It then computes the mean and SD of pixels in an
  annulus around the peak and makes sure that the peak deviates from this
  local mean by more than a criterion number of SDs (the peak criterion).
  Neighboring pixels inside the inner radius of the annulus are added to
  the list of pixels to be replaced if they deviate by a lower criterion
  (the grow criterion).  The patch of pixels is then replaced by fitting a
  polynomial to adjacent pixels and interpolating from the polynomial.

  After the peaks are found in a patch, the program next finds the
  difference between each pixel and the mean of the eight adjacent pixels.
  The mean and SD of this difference is computed, then pixels are sought
  that deviate from the mean by yet another criterion, the difference
  criterion.  When such a pixel is found, neighboring pixels are examined
  and added to the patch of pixels to replace if their difference exceeds
  the grow criterion.  Replacement proceeds as above.

  Two methods are used because the first method is probably more reliable
  for dealing with strong peaks that extend over several pixels, while the
  second method is definitely better for finding small X-rays.

  Tuning the removal of X-rays would primarily involve adjusting three of
  the criteria.  The peak and difference criteria would be adjusted down or
  up to increase or decrease the number of deviant pixels that are found.
  The grow criterion would be adjusted down or up depending on whether too
  few or too many pixels are included in a patch that is replaced.

  For manual removal of defects, prepare an IMOD model file to specify the
  points to be replaced.  There should be up to four separate objects: one
  for patches of points to be replaced on each section; one for patches to
  be replaced on only a single section, one for lines to be replaced on a
  single section, and one for lines to be replaced on a single section.

  To specify a patch of points, start a new contour and place a point
  inside of EVERY pixel in the patch.  Each separate patch should be in a
  separate contour.  If the correction is to be made on only a single
  section, all of the points must lie on that section; but the points for a
  patch to be corrected on all sections can be on more than one section,
  because sometimes they are more discernable on particular sections.
  
  To specify a line of points, make a contour with two points, at the start
  and end of the line to be replaced.  Lines must be horizontal or
  vertical.  Each pixel will be replaced by the average of the two
  pixels on either side of the line.  Put each line in a different
  contour.

  Ccderaser uses the PIP package for input (see the manual page for pip(1))
  and can take input interactively only for specifying manual replacement
  with a model file, to maintain compatibility with old command files.  The
  following options can be specified either as command line arguments (with
  the -) or one per line in a command file or parameter file (without 
  the -):

  -input OR -InputFile   File name
     Input image file.  This may also be entered after all arguments on the
     command line.

  -output OR -OutputFile   File name
     Output image file.  This may also be entered after an input file name
     on the command line.  If no output file is specified and the program
     is not run in trial mode, pixels will be replaced in the input file.
     USE REPLACEMENT OPTION WITH CAUTION.

  -find OR -FindPeaks   (Boolean entry, no value expected)
     Find and erase peaks a criterion # of SDs above or below background.
     This option must be included for automatic removal of X-rays.

  -peak OR -PeakCriterion   Floating point
     Criterion # of SDs above local mean for erasing peak based on 
     intensity (the default is 10 SDs).

  -diff OR -DiffCriterion   Floating point
     Criterion # of SDs above mean pixel-to-pixel difference for erasing a
     peak based on differences (the default is 10 SDs)

  -grow OR -GrowCriterion   Floating point
     Criterion # of SDs above mean for adding points to peak (the default
     is 4 SDs).

  -scan OR -ScanCriterion   Floating point
     Criterion # of SDs of mean of scan area for picking peaks in initial
     scan (the default is 3 SDs).

  -radius OR -MaximumRadius   Floating point
     Maximum radius of peak area to erase (the default is 2.1 pixels).

  -outer OR -OuterRadius   Floating point
     Outer radius of annulus around a peak in which to calculate local mean
     and SD (the default is 4.0 pixels).

  -xyscan OR -XYScanSize   Integer
     Size of regions to compute mean and SD in for initial scans (the
     default is 100 pixels).

  -edge OR -EdgeExclusionWidth   Integer
     Width of area to exclude on all edges of image in pixels (default 0).

  -points OR -PointModel   File name
     Output model file with points replaced in peak search.  Each patch of
     points will be in a separate contour.  Patches are sorted into
     separate objects based on how much the peak exceeds a criterion.

  -model OR -ModelFile   File name
     Input model file specifying points or lines to be erased.

  -lines OR -LineObjects   List of integer ranges
     List of objects that define lines to be replaced.  Ranges can be
     entered, and / to specify all objects.

  -allsec OR -AllSectionObjects   List of integer ranges
     List of objects with points to be replaced on all sections.  Ranges
     can be entered, and / to specify all objects.

  -border OR -BorderSize   Integer
     Size of border around points in patch, which contains the points which
     will be fit to (the default is 2 pixels)

  -order OR -PolynomialOrder   Integer
     Order of polynomial to fit to border points (the default is 2, which
     includes terms in x, y, x**2, y**2 and x*y).

  -exclude OR -ExcludeAdjacent   (Boolean entry, no value expected)
     Exclude points adjacent to patch points from the fit; in other words,
     compute the polynomial fit to points that do not touch the ones being
     replaced.

  -trial OR -TrialMode   (Boolean entry, no value expected)
     Analyze for replacement points without writing output image file.

  -verbose   (Boolean entry, no value expected)
     Print details on patches being replaced.

  -param OR -ParameterFile   Parameter file name
     Read parameter entries from file.

  -help OR -usage   (Boolean entry, no value expected)
     Print help output.

  -StandardInput
     Read parameter entries from standard input.


  If the program is started with no command line arguments, it reverts to
  interactive  input with the following entries:

  Input image file

  Output image file, or <Return> to place modified sections back into
  the input file.  USE REPLACEMENT OPTION WITH CAUTION

  Model file

  A list of objects which specify points or lines to be replaced on
  all sections, or / if all objects do so, or Return if none do.
  Ranges may be entered.

  A list of objects which specify lines to be replaced, or / if
  all objects do so, or Return if none do.  Ranges may be entered.

  Size of the border around the points in a patch, which contains the
  points which will be fit to (/ for default of 2 pixels)
  
  Order of polynomial (/ for default of 2, which includes terms in
  x, y, x**2, y**2 and x*y)

  0 to exclude or 1 to include points adjacent to the points being replaced
  in the polynomial fit (/ for default of 1)
  
HHIISSTTOORRYY
  Written by David Mastronarde  11/10/98
  Automatic X-ray removal and pioneer use of PIP input, 6/9/03
