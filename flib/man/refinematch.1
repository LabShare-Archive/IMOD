     BBoouullddeerr LLaabboorraattoorryy ffoorr 33--DDiimmeennssiioonnaall EElleeccttrroonn MMiiccrroossccooppyy ooff CCeellllss

REFINEMATCH(1)							 REFINEMATCH(1)

NNAAMMEE
	refinematch - Solve for a refined match between two tomograms

SSYYNNOOPPSSIISS
	refinematch

DDEESSCCRRIIPPTTIIOONN
  REFINEMATCH will solve for a general 3-dimensional linear
  transformation to align two volumes to each other.  It performs
  multiple linear regression on the  displacements between the volumes
  determined at a matrix of positions.  The displacements must be
  contained in a file with the following form:
  
  Number of displacements
  One line for each displacement consisting of the X, Y, and Z
     coordinates in the first volume, then the displacements in X, Y
     and Z involved in moving from the first to the second volume
  
  The program will automatically eliminate "outliers", patch
  displacements that are likely to be incorrect because they are so
  extreme, when compared to the rest of the displacements.  This
  elimination is conservative, but if for some reason it operates
  incorrectly, use FINDWARP, where you can control the parameters of
  elimination or stop the elimination from occurring.  The program will
  eliminate up to 10% of the patches.  If more than this number are
  bad, either get a new set of patches that do not approach so close to
  the edge of the volume, make a model in the tomogram with contours
  enclosing the patches to use, eliminate the bad ones from the file by
  hand, or use FINDWARP to eliminate a whole row or column of patches.
  When the mean residual exceeds a value that you specify, the program
  will exit with an error.

  A model specifying which patches to include in the fit can be quite
  simple, consisting of just a single contour enclosing the region 
  where patches are generally good.  This contour can be drawn in any 
  Z plane of the flipped tomogram.  However, if the good region
  changes through the depth of the tomogram, you can draw contours at
  several Z levels.  If you have two layers of patches, draw two
  contours, one near the top and one near the bottom of the tomogram;
  if you have three layers, add another contour in the middle, etc.
  For a given patch, the program will find the contour at the nearest
  Z level and use that one to determine whether to include the patch.

  If there is only one layer of patches in one dimension, there is
  insufficient information to solve for the full transformation, so
  the program will solve for only two of the three columns of the
  transformation matrix.  This typically occurs in the Y dimension,
  in which case the second column of the matrix is fixed at 0, 1, 0.

  
  Inputs to the program:
  
  Name of file with positions and displacements
  
  Either the file name of one of the volumes, or the X, Y, and
     Z dimensions of the volumes.
  
  Name of an Imod model file with contours enclosing the patches to
     be included in the fit, or Return to use all patches.

  Limiting value for the mean residual; above this value, the program
     will exit with an error.

  Name of output file in which to place the transformation, or Return
     for no output to a file


HHIISSTTOORRYY
  Written by David Mastronarde, 1995
  12/24/98: added outlier elimination; 6/6/99: added error exit
