     BBoouullddeerr LLaabboorraattoorryy ffoorr 33--DDiimmeennssiioonnaall EElleeccttrroonn MMiiccrroossccooppyy ooff CCeellllss

SOLVEMATCH(1)							  SOLVEMATCH(1)

NNAAMMEE
	solvematch - Solve for transformation matching one tomogram to another

SSYYNNOOPPSSIISS
	solvematch

DDEESSCCRRIIPPTTIIOONN
  Solvematch will solve for a 3-dimensional linear transformation
  relating the tomogram volumes resulting from tilt series around two
  different axes.  It can use information from the 3-D coordinates of
  fiducials found by Tiltalign, or from IMOD models of corresponding
  points in the two volumes, or from both of these sources together.
  Current versions of Tiltalign produce fiducial lists with coordinates
  corresponding the coordinates in the tomogram, thus providing all of
  the information that Solvematch needs to find the transformation.  Older
  versions of Tiltalign produced coordinates centered around zero; this
  situation is discussed below.

Using Fiducial Coordinates
  When you use fiducial coordinates, the program needs to know how the
  fiducial points correspond between the two tilt series.  If it is given
  a small list of points which do correspond, it can find the rest of the
  correspondences and ignore any points from either set that do not have a
  mate.  There are two restrictions in using this capability.  First, one
  must identify at least 4 initial correspondences; in fact, having at
  least 5 is recommended.  Second, if there are fiducials on both surfaces
  of the section, this initial list must include at least one from each
  surface.

  When you enter point numbers, use the numbers listed on the left in
  the fiducial coordinate file.  These numbers may not correspond to
  the contour numbers in the original fiducial model if some contours
  were not included in the solution.  These numbers do not need to be
  sequential; i.e., you can delete points from the coordinate file.
  The program will refer to points by these numbers.  When you have
  both fiducial coordinates and points from matching models, it will
  refer to the latter points by the negative of their point number.

  When using fiducial coordinates, you also need to indicate to Solvematch
  whether the gold fiducials are on one surface or distributed in depth
  (typically but not necessarily on two surfaces).  If there is gold on
  only one surface, you must determine whether the two tomograms are
  inverted in Y (Z in flipped orientation); i.e. whether the gold is on
  the "top" of the section in one tomogram and the "bottom" in the other.
  The program needs to know this because there is no reliable information
  about this polarity in the fiducial coordinates.

Using Matching Models
  When fiducial points from Tiltalign are not available, you can use
  models of corresponding points to register the two volumes.  Pick a set
  of points that can be localized well in both tomograms and enter them in
  the same order into a model for each tomogram.  The points can be in the
  same or in different objects or contours, as long as they occur in the
  same order in each model.  The points should be well-distributed in in
  all dimensions.  At least 8 points are recommended.  If this is to
  provide the basis for the final alignment of the volumes, they should be
  relatively near the 8 corners of the volume, and more points should be
  used for greater accuracy; but if the alignment is to be refined with
  correlation, this is not necessary.

Using Old, Relative Fiducial Coordinates
  With fiducial coordinates from older versions of Tiltalign, the program
  can solve for the 3 by 3 transformation but not for the shifts in X, Y
  and Z.  There are two ways to get these shifts: by cross-correlation
  of one transformed volume with the other, and by giving Solvematch
  models of corresponding points in the two tomograms.  The shell script
  that does correlations, Matchshifts, is generally successful.  If it
  fails, you have two options: rerun Tiltalign to get absolute
  coordinates; or create matching models.  If you do this, 3-6 points are
  recommended.  If fiducials are essentially on one surface, then the
  modeled points are needed to find the scaling in Y (Z in flipped
  orientation) between the two tomograms.  In this case, be sure to
  distribute the points in depth (rather than all on one surface) and use
  5-6 points so as to provide information on this scaling.
  
Program Operation
  The program will automatically remove "outliers", pairs of points
  that are likely to be incorrect because their residual errors are
  so extreme relative to the other points.  Up to 10% of points may
  be removed in this way.  If, even after removing such outliers, the
  maximum residual in the linear fit is still higher than a value that
  you specify, then the program will exit with an error.

  The program determines the transformation and computes the deviation
  between each actual point in the first tomogram and the transformation of
  the corresponding point in the second tomogram.  It reports the mean and
  S.D. of these deviations, the number of the point with the highest
  deviation, and the magnitude of its deviation.

Inputs and Options
  Solvematch uses the PIP package for input (see the manual page for pip(1))
  and can also take input interactively to maintain compatibility with old 
  command files.  The following options can be specified either as command
  line arguments (with the -) or one per line in a command file or parameter
  file (without the -):

INSERT OPTION TEXT HERE

  -StandardInput
     Read parameter entries from standard input.


Old Style Input
  If the program is started with no command line arguments, it reverts to
  interactive input and is restricted to older modes of operation.  The
  input takes different forms depending on what data are available.  The
  inputs to the program when fiducials from Tiltalign are available are:
  
  Name of file with coordinates of fiducials from the first tilt series

  Name of file with coordinates of fiducials from the second series
  
  A list of the points in series 1 for which a corresponding point in
     series 2 is known with confidence, or / if all points correspond between
     the two series.
  
  A list of the corresponding points in the second series, or / if all points
     correspond between the two series.

  The values of X axis tilt that were used in generating the first and
     second tomograms.

  The limiting value for the maximum residual, so that the program will
     exit with an error if this value is exceeded.

  Enter either 0 to determine shifts from model files of corresponding
     points, or -1, 1, or 2 to determine just the 3 by 3 transformation
     and not the shifts.  Enter 2 if there are fiducials on two
     surfaces, 1 if fiducials are on one surface and the tomograms are
     NOT inverted relative to each other, or -1 if the tomograms are
     inverted and there are fiducials on only one surface.

  IF you entered 0, make the following four entries:

     Either the file name or the X, Y and Z dimensions of the first
       tomogram

     Name of model of points from the first tomogram
  
     Either the file name or the X, Y and Z dimensions of the second
       tomogram

     Name of model of points from the second tomogram
  
  Finally, enter name of file for output of the transformation, or
     Return for none

  
  Inputs to the program when matching models alone are being used:
  
  A blank line (Return) in place of the name of the first fiducial file
  
  The limiting value for the maximum residual

  Either the file name or the X, Y and Z size of the first tomogram

  Name of model of points from the first tomogram
  
  Either the file name or the X, Y and Z size of the second tomogram

  Name of model of points from the second tomogram
  
  Name of file for output of the transformation, or Return for none
  


HHIISSTTOORRYY
  Written by David Mastronarde, 1995; modified for zero shifts, 7/4/97
  Added outlier elimination and error exit, 6/5/99
  Added ability to start with small initial set of matches, 3/20/00
  Added ability to use matching models only, 7/21/02
  Fixed treatment of single-surface case and converted to PIP, 12/24/03
  Added ability to deal with absolute fiducial coordinates, 6/9/04
