	     BBoouullddeerr LLaabboorraattoorryy ffoorr 33--DDiimmeennsssiioonnaall FFiinnee SSttrruuccttuurree

SOLVEMATCH(1)							  SOLVEMATCH(1)

NNAAMMEE
	solvematch - Solve for transformation matching one tomogram to another

SSYYNNOOPPSSIISS
	solvematch

DDEESSCCRRIIPPTTIIOONN
  SOLVEMATCH will solve for a 3-dimensional linear transformation
  relating the tomogram volumes resulting from tilt series around two
  different axes.  It uses information from the 3-D coordinates of
  fiducials found by TILTALIGN.  With this information alone, it can
  solve for the 3 by 3 transformation but not for the shifts in X, Y
  and Z.  There are two ways to get these shifts: by cross-correlation
  of one transformed volume with the other, and by giving SOLVEMATCH
  models describing corresponding points in the two tomograms.  The
  shell script that does correlations, MATCHSHIFTS, should be able to
  handle large displacements between the two volumes, so it should
  rarely be necessary to use models.  
  
  To use correlation, simply indicate to SOLVEMATCH whether the gold
  fiducials are on one or two surfaces.  If there is gold on only one
  surface, you also need to determine beforehand whether the two
  tomograms are inverted in Y (Z in flipped orientation); i.e. whether
  the gold is on the "top" of the section in one tomogram and the
  "bottom" in the other.  The program needs to know this because it
  introduces two dummy fiducials to fix the scaling in Y at either 1.0
  or -1.0.  After SOLVEMATCH is run, the shell script "matchshifts"
  will perform the necessary operations to find the shifts and
  incorporate them into the transformation.

  If you do need to create models of corresponding points, pick a set
  of points that can be localized well in both tomograms and enter them
  in the same order into a model for each tomogram.  The points can be
  in the same or in different objects or contours, as long as they
  occur in the same order in each model.  If the fiducials from
  TILTALIGN are not confined to one surface, then they provide nearly
  all of the information needed to determine the transformation, and
  the modeled points are needed only to determine the X, Y, and Z
  shift between the tomograms.  In this case, three modeled points are
  sufficient.  However, if fiducials are essentially on one surface,
  then the modeled points are needed to find the scaling in Y (Z in
  flipped orientation) between the two tomograms.  In this case, be
  sure to distribute the points in depth (rather than all on one
  surface) so as to provide information on this scaling.  Here, 5 or 6
  points are recommended.
  
  The program needs to know how the fiducial points correspond between
  the two tilt series.  If it is given a small list of points which do
  correspond, it can find the rest of the correspondences and ignore
  any points from either set that do not have a mate.  There are two
  restrictions in using this capability.  First, one must identify at
  least 4 initial correspondences; in fact, having at least 5 is
  recommended.  Second, if there are fiducials on both surfaces of the
  section, this initial list must include at least one from each
  surface.

  The program will automatically remove "outliers", pairs of points
  that are likely to be incorrect because their residual errors are
  so extreme relative to the other points.  Up to 10% of points may
  be removed in this way.  If, even after removing such outliers, the
  maximum residual in the linear fit is still higher than a value that
  you specify, than the program will exit with an error.

  Inputs to the program:
  
  Name of file with coordinate of fiducials from the first tilt series

  Name of file with coordinate of fiducials from the second series
  
  A list of the points in series 1 for which a corresponding point in
     series 2 is known with confidence.  Ranges may be entered
     (e.g. 1-5,7,6,-12).  Enter / if all points correspond between the
     two series.
  
  A list of the corresponding points in the second series.  The same
     number of values must be entered in this list as in the preceding
     list.  Again,  enter / if all points correspond between the
     two series.

  The values of X axis tilt that were used in generating the first and
     second tomograms.  These angles are needed to make the fiducial
     coordinates from TILTALIGN correspond to the actual positions of
     the particles in the tomograms.

  The limiting value for the maximum residual, so that the program will
     exit with an error if this value is exceeded.

  Enter either 0 to determine shifts from model files of corresponding
     points, or -1, 1, or 2 to determine just the 3 by 3 transformation
     and not the shifts.  Enter 2 if there are fiducials on two
     surfaces, 1 if fiducials are on one surface and the tomograms are
     NOT inverted relative to each other, or -1 if the tomograms are
     inverted and there are fiducials on only one surface.

  IF you entered 0, make the following four entries:

     Either the file name of the first tomogram, or the X, Y and Z
       dimensions and the X, Y and Z origin of that tomogram.
       (NOTE: the standard origin values put out by TILT are NX/2, 
       NY/2, and 0.)

     Name of model of points from the first tomogram
  
     Either the file name of the second tomogram, or the X, Y and Z
       dimensions and X, Y and Z origin of that tomogram.

     Name of model of points from the second tomogram
  
  Finally, enter name of file for output of the transformation, or
     Return for none

  The program determines the transformation and computes the deviation
  between each actual point in the first tomogram and the
  transformation of the corresponding point in the second tomogram.  It
  reports the mean and S.D. of these deviations, the number of the
  point with the highest deviation, and the magnitude of its deviation.
  (The modeled points are placed in the array after the fiducial
  points, so the highest numbers refer to these points.)

HHIISSTTOORRYY
	  Written by David Mastronarde, 1995; modified for zero shifts, 7/4/97
	  Added outlier elimination and error exit, 6/5/99
	  Added ability to start with small initial set of matches, 3/20/00
