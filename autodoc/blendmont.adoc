Version = 1.0
Pip = 1
[Field = ImageInputFile]
short = imin
type = FN
usage = Montaged image input file to be blended
tooltip = 
manpage = Montaged image input file to be blended.

[Field = PieceListInput]
short = plin
type = FN
usage = File with list of piece coordinates for image input file
tooltip = 
manpage = File with list of piece coordinates for image input file.

[Field = ImageOutputFile]
short = imout
type = FN
usage = Output file for blended images
tooltip = 
manpage = Output file for blended images.

[Field = PieceListOutput]
short = plout
type = FN
usage = File for list of coordinates of pieces in output image file
tooltip = 
manpage = File for list of coordinates of pieces in output image file.  This
entry may be omitted if the output images are not being cut into pieces.

[Field = RootNameForEdges]
short = rootname
type = CH
usage = Root name for edge function and .ecd files
tooltip = 
manpage = Root name for edge function and .ecd files.  Two files will be
created or sought for, with the extensions .xef and .yef attached to this root
name.

[Field = ModeToOutput]
short = mode
type = I
usage = Mode for output file - 0 for bytes, 1 for integers, 2 for reals
tooltip = 
manpage = Mode for output file: 0 for bytes, 1 for integers, 2 for reals.  The
default is the same mode as the input file.

[Field = FloatToRange]
short = float
type = B
usage = Stretch intensities of each output section to fill range of data mode
tooltip = 
manpage = Stretch intensities of each output section to fill range of data
mode.

[Field = TransformFile]
short = xform
type = FN
usage = File with transformations to apply
tooltip = 
manpage = File with g transformations to apply to align the images.

[Field = TransformCenterXandY]
short = center
type = FP
usage = X and Y coordinates of center of transformations
tooltip = 
manpage = X and Y coordinates of center of transformations.  The default is the
center of the input image.

[Field = InterpolationOrder]
short = order
type = I
usage = Order of interpolation to use (1: linear, 2: quadratic, 3: cubic;
default is 3)
tooltip = 
manpage = Order of interpolation to use: 1 for linear, 2 for quadratic (the 
only one available before IMOD 3.6), 3 for cubic; the default is cubic when
the program is run with PIP input and quadratic when run with sequential
input.

[Field = DistortionField]
short = distort
type = FN
usage = Image distortion field file to use for undistorting images
tooltip = 
manpage = Image distortion field file to use for undistorting images.  The 
undistortion is applied when computing edge functions.

[Field = ImagesAreBinned]
short = imagebinned
type = I
usage = The current binning of the images
tooltip = 
manpage = The current binning of the images, so that the image distortion
field can be applied correctly.  This entry is required when doing image
distortion corrections unless
the program can determine the binning unambiguously from the image size.

[Field = GradientFile]
short  = gradient
type = FN
usage = File with magnification gradients to be applied for each image
tooltip = 
manpage = File with magnification gradients to be applied for each section.
This should be a file listing the tilt angle, the percent magnification change
per micron of Z height, and the degrees of rotation per micron of Z height
for each section, such as is produced by Extractmaggrad.  The mag gradient
correction is applied before a distortion field correction and is used when
computing edge functions.

[Field = AdjustedFocus]
short = adjusted
type = B
usage = Focus was adjusted for changing Z height when montage was acquired
tooltip = 
manpage = 

[Field = AddToGradient]
short = addgrad
type = FP
usage = Add to or set the mag and rotation gradients with the given values
tooltip =
manpage = The magnification gradient correction is specified by
two parameters: % of mag change per micron of Z height, and degrees of
rotation per micron of Z height.  If -gradient has been entered, this option
can be used to increment the values in the gradient file for each section. 
If -gradient has
not been entered, the values entered here will be used for all sections; but in
this case the -geometry option must be entered to provide additional
information, and also -tiltfile if the data are at different tilt angles.

[Field = TiltFile]
short = tiltfile
type = FN
usage = File with tilt angles only (used if no mag gradient file)
tooltip = 
manpage = Name of file with tilt angles, one per line.  These angles will be
used in computing mag gradients, only if there is no
mag gradient file to supply the tilt angles.

[Field = OffsetTilts]
short = offset
type = F
usage = Add given value to tilt angles from gradient or tilt file
tooltip =
manpage = Add the given value to the tilt angles from the gradient file or the
tilt file.
Sometimes the gradient that gives the lowest error in registering the pieces
will differ between the positive and negative side of the tilt series.  This
entry can be used to give a better overall error reduction.

[Field = TiltGeometry]
short = geometry
type = FT
usage = Specify pixel size, tilt axis rotation angle, and tilt angle
tooltip =
manpage = When magnification gradients are being corrected for, this entry 
can be used in place of a gradient file to specify the 
pixel size in nanometers, tilt axis rotation angle, and tilt angle to be used
for the gradient computation.  The entry has no effect if a gradient file is
provided.

[Field = JustUndistort]
short = justUndistort
type = B
usage = Just correct distortions in each frame without blending
tooltip =
manpage = With this entry, the program can be used just to correct for 
magnification gradients and distortion fields, without computing edge functions
or blending images.  The resulting images are the same as those used to 
compute edge functions, and will be suitable for fixing edge functions in 
Midas.  Either -distort or -gradient must be entered with this option.  The
sections to do may be specified, but all entries with regard to frame and total
sizes in X and Y and edge functions will be ignored.

[Field = TestMode]
short = test
type = B
usage = Compute overlap errors only
tooltip =
manpage = This entry runs the program in a special mode in which it will 
compute edge functions and find the best shifts of the pieces for a given
magnification gradient correction.  Output images will not be computed, 
although an empty output file will be produced.

[Field = SloppyMontage]
short = sloppy
type = B
usage = Do initial cross-correlations for finding edge functions
tooltip = 
manpage = Do initial cross-correlations for finding edge functions and shift
pieces to minimize displacements in the overlap zones

[Field = VerySloppyMontage]
short = very
type = B
usage = Do correlations with parameters for finding very big displacements
tooltip = 
manpage = This option acts like SloppyMontage and also sets several parameters
for dealing with very sloppy montages with displacements potentially bigger
than half the width of the overlap zones.  The aspect ratio of the area used
for correlating the overlap zones is increased from 2 to 5 and the filter
parameter radius1 is set to -0.01 to eliminate more low frequencies from the
correlation.  The fraction of the area over which images are tapered is 
increased from 0.1 to 0.2 to further reduce the frequencies of edge effects,
and the area being correlated is made wider by setting the extra width
fraction to 0.25.  

[Field = ShiftPieces]
short = shift
type = B
usage = Shift pieces to minimize displacements in the overlap zones
tooltip = 
manpage = Shift pieces to minimize displacements in the overlap zones.  The
default is to use information from edge functions and from cross-correlations
for each section and pick the one that gives lowest error.

[Field = ShiftFromEdges]
short = edge
type = B
usage = Use only edge functions for shifting pieces
tooltip = 
manpage = Use only edge functions for shifting pieces.

[Field = ShiftFromXcorrs]
short = xcorr
type = B
usage = Use only cross-correlations of overlap zones for shifting pieces 
(legacy behavior)
tooltip = 
manpage = Use only cross-correlations of overlap zones for shifting pieces 
(legacy behavior).

[Field = ReadInXcorrs]
short = readxcorr
type = B
usage = Read displacements from .ecd file instead of computing correlations
tooltip = 
manpage = Read displacements in the overlap zones from an existing .ecd file
instead of computing correlations.

[Field = SectionsToDo]
short = sections
type = LI
usage = Sections to blend into output file
tooltip = 
manpage = List of sections to blend into output file; comma-separated ranges
are allowed.

[Field = StartingAndEndingX]
short = xminmax
type = IP
usage = Minimum and maximum X index coordinates to output
tooltip = 
manpage = Minimum and maximum X index coordinates to output (numbered from 0).
The default is to output the entire image.

[Field = StartingAndEndingY]
short = yminmax
type = IP
usage = Minimum and maximum Y index coordinates to output
tooltip = 
manpage = Minimum and maximum Y index coordinates to output.

[Field = BinByFactor]
short = bin
long = BinByFactor
type = I
usage = Use binning to reduce images in size by the given factor
tooltip = 
manpage = Use binning to reduce images in size by the given factor.  Binning
is applied to the data just before output, so the starting and ending X and Y
coordinates to output should be specified in unbinned pixels.  With binning,
the output must be a single piece.

[Field = MaximumNewSizeXandY]
short = maxsize
type = IP
usage = Maximum size in X and Y of pieces in output file
tooltip = 
manpage = Maximum size in X and Y of pieces in output file.  The default is to
make output be a single piece, unless it exceeds the limits of the program.

[Field = MinimumOverlapXandY]
short = minoverlap
type = IP
usage = Minimum overlap between pieces in X and Y in output file
tooltip = 
manpage = Minimum overlap between pieces in X and Y in output file.  The
default is an overlap of 2.

[Field = OldEdgeFunctions]
short = oldedge
type = B
usage = Use existing edge functions
tooltip = 
manpage = Use existing edge functions, if they exist, rather than computing new
ones.

[Field = FramesPerNegativeXandY]
short = perneg
type = IP
usage = Number of frames per negative for multi-negative montage
tooltip = 
manpage = Number of frames in X and Y per negative for a multi-negative 
montage.  This option could be used instead of having negative numbers in the
piece list file.

[Field = MissingFromFirstNegativeXandY]
short = missing
type = IP
usage = Number of pieces missing from first negative in X and Y
tooltip = 
manpage = Number of pieces missing from the first negative in X and Y.  For
example, if there are 3 negatives across, with 2, 4, and 1 pieces in X
from each, then the number missing is 2.

[Field = BlendingWidthXandY]
short = width
type = IP
usage = Width in X and Y across which to blend overlaps
tooltip = 
manpage = Width in X and Y across which to blend overlaps.  The default is:
80% of the overlap zone width for overlap width less than 63,
50 pixels for overlap width between 63 and 100, or
50% of the overlap width for overlap width greater than 100.

[Field = BoxSizeShortAndLong]
short = boxsize
type = IP
usage = Size of box for finding edge functions in short and long directions
tooltip = 
manpage = Size of box for finding edge functions in short and long directions.
The short direction is across an overlap zone, the long direction is along it.
The default size is 10 pixels in the short direction for frame sizes up to 
1024 pixels, increasing proportional to the maximum dimension of the frame 
above 1024.  The default in the long direction is 1.5 times the size in the 
short direction.

[Field = GridSpacingShortAndLong]
short = grid
type = IP
usage = Spacing of edge function grid in short and long directions
tooltip = 
manpage = Spacing of edge function grid in short and long directions.  The
default is 10 pixels in each direction for frame sizes up to 1024 pixels,
increasing proportional to the maximum dimension of the frame above 1024.

[Field = IndentShortAndLong]
short = indents
type = IP
usage = Indentation of edge function from edge of overlap in short and long 
directions
tooltip = 
manpage = Borders at the edge of the overlap zone in the short and long 
directions which will be excluded when finding edge functions.  The default
size is 5 pixels in each direction for frame sizes up to 1024 pixels,
increasing proportional to the maximum dimension of the frame above 1024.

[SectionHeader = XCOptions]
usage = CROSS-CORRELATION CONTROL OPTIONS 
manpage = CROSS-CORRELATION CONTROL OPTIONS
^  These options control the cross-correlations used to find
the initial alignment in the overlap zones when montages are sloppy.

[Field = AspectRatioForXcorr]
short = aspect
type = F
usage = Maximum aspect ratio of areas cross-correlated in overlap zones
tooltip = 
manpage = Maximum aspect ratio of areas cross-correlated in overlap zones.
The default is 2, which is generally adequate.  Larger values are required if
the displacements can be very large, but the value should not be made much
larger than necessary because the correlations will take longer to compute and 
may be poorer quality if there is substantial distortion between the two images
in an overlap zone.

[Field = PadFraction]
short = pad
type = F
usage = Fraction to pad areas correlated in overlap zones
tooltip = 
manpage = Areas from the overlap zones will be padded by this fraction on
each side for correlation.  The default value is 0.45, which allows large
shifts to be measured unambiguously.  Padding for the short dimension will be 
this fraction times the size in that dimension; padding in the long dimension
will be either this fraction times the long dimension size, or 0.9 times the
size in the short dimension, whichever is smaller.

[Field = TaperFraction]
short = taper
type = F
usage = Fraction to taper inside of areas correlated in overlap zones
tooltip = 
manpage = Areas from the overlap zones will be tapered down to their mean
intensities over a distance equal to this fraction times the size in the
respective dimension.  

[Field = ExtraXcorrWidth]
short = extra
type = F
usage = Fraction to increase width of areas correlated in overlap zones
tooltip = 
manpage = This entry will increase the width of the areas correlated in
overlap zones by including image area in the interior of each frame, i.e.,
outside the overlap zone.  The width of the extra area is this fraction times
the width of the area within the overlap zone.  This option is appropriate if
montages are very sloppy, particularly if they tend to overlap by much more
than the nominal amount.

[Field = FilterRadius1]
short = radius1
type = F
usage = Left cutoff radius for correlation filter
tooltip = 
manpage = When this entry is positive, low spatial frequencies in the overlap
zone cross-correlations will be attenuated by a Gaussian curve that is 1 at
this cutoff radius and falls off below this radius with a standard deviation
specified by FilterSigma2.  Spatial frequency units range from 0 to 0.5.
A negative entry is used to set the starting point of the filter specified
by FilterSigma1, which gives a more predictable attenuation of low frequencies.

[Field = FilterRadius2]
short = radius2
type = F
usage = Right cutoff radius for correlation filter
tooltip = 
manpage = High spatial frequencies in the cross-correlation will be attenuated
by a Gaussian curve that is 1 at this cutoff radius and falls off above this
radius with a standard deviation specified by FilterSigma2.

[Field = FilterSigma1]
short = sigma1
type = F
usage = Sigma for low-frequency inverted Gaussian correlation filter
tooltip = 
manpage = Sigma value to filter low frequencies in the correlations with a
curve that is an inverted Gaussian.  This filter is 0 at 0 frequency and decays
up to 1 with the given sigma value.  However, if a negative value of radius1
is entered, this filter will be zero from 0 to |radius1| then decay up to 1.
The default is 0.05.

[Field = FilterSigma2]
short = sigma2
type = F
usage = Sigma for Gaussian rolloff below radius1 and above radius2
tooltip =
manpage = Sigma value for the Gaussian rolloff below and above the cutoff
frequencies specified by FilterRadius1 and FilterRadius2

[Field = XcorrDebug]
short = xcdbg
type = B
usage = Output image files with overlap zones and cross-correlations
tooltip = 
manpage = Output image files with the padded images being correlated in the
overlap zones and with the cross-correlations.  Separate files are generated
for X and Y edges, with extensions .xdbg and .ydbg.

[Field = ParameterFile]
short = param
type = PF
usage = Read parameter entries from file
tooltip = 
manpage = Read parameter entries as keyword-value pairs from a parameter file.

[Field = usage]
short = help
type = B
usage = Print help output
tooltip = 
manpage = Print help output.
