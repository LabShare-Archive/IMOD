#!/bin/csh -f
# A script to make links in /usr/lib so that 3dmod will run by clicking on it
# on the Mac
#
#  $Author$
#
#  $Date$
#
#  $Revision$
#
#  $Log$

if (! $?IMOD_DIR) then
    echo 'The environment variable IMOD_DIR must be defined before running this command'
    exit 1
endif

if ($#argv == 0) then
cat <<EOF
This script will install or uninstall links in /usr/lib to the IMOD and Qt
libraries in $IMOD_DIR so that you can run 3dmod by clicking on it.
You must run it as root with sudo.  Enter
    linklibs-mac -i    to make the links, or
    linklibs-mac -u    to remove the links
EOF
exit
endif

if ("$argv[1]" != '-i' && "$argv[1]" != '-u') then
    echo "Illegal argument $argv[1] - you must enter -i or -u"
    exit 1
endif

set exist = 0
set imodlibs = (libdiaqt.dylib libimod.dylib libiimod.dylib)

# Look for imod libs in /usr/lib
#
foreach i ($imodlibs)
    if (-e /usr/lib/$i) then
        set exist = 1
        ls -l /usr/lib/$i | awk '{print $9, $10, $11}'
    endif
end

# Look for Qt libs in /usr/lib
#
cd $IMOD_DIR/qtlib
foreach i (*)
    if (-e /usr/lib/$i) then
        set exist = 1
        ls -l /usr/lib/$i | awk '{print $9, $10, $11}'
    endif
end

echo " "

# confirm removal of existing links
#
if ("$argv[1]" == '-u') then
    if ($exist == 1) then
        echo "The above files and/or links will be removed."
        echo -n "Enter Y if you are sure you want to proceed: "
        set answer = $<
        if ($answer != 'Y' && $answer != 'y') exit 0
    else
        echo "There are no files or links to remove from /usr/lib"
        exit 0
    endif

else
    if ($exist == 1) then
        echo "The above files and/or links already exist in /usr/lib and need to be removed."
        echo -n "Enter Y if you are sure you want to proceed: "
        set answer = $<
        if ($answer != 'Y' && $answer != 'y') exit 0
    endif
endif

# now remove the links
#
if ($exist == 1) then
    foreach i ($imodlibs)
        \rm -rf /usr/lib/$i
    end
    foreach i (*)
        \rm -rf /usr/lib/$i
    end
endif

if ("$argv[1]" == '-u') then
    echo "The links and/or files have been removed"
    exit 0
endif

# now make the links
#
foreach i ($imodlibs)
    ln -s $IMOD_DIR/lib/$i /usr/lib/$i
end
foreach i (*)
    ln -s $IMOD_DIR/qtlib/$i /usr/lib/$i
end

echo "The appropriate links have been made in /usr/lib"
exit 0
